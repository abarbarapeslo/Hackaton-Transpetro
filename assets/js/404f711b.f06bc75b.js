"use strict";(self.webpackChunkhackathon_transpetro=self.webpackChunkhackathon_transpetro||[]).push([[488],{772:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"implementacao_tecnica/back_end","title":"Back End","description":"Introdu\xe7\xe3o","source":"@site/docs/implementacao_tecnica/back_end.md","sourceDirName":"implementacao_tecnica","slug":"/implementacao_tecnica/back_end","permalink":"/Hackaton-Transpetro/implementacao_tecnica/back_end","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"Back End"},"sidebar":"defaultSidebar","previous":{"title":"Plano de Infraestrutura","permalink":"/Hackaton-Transpetro/implementacao_tecnica/infraestrutura"},"next":{"title":"Seguran\xe7a","permalink":"/Hackaton-Transpetro/implementacao_tecnica/seguranca"}}');var i=n(4848),r=n(8453);const a={sidebar_position:5,title:"Back End"},o=void 0,c={},l=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"Core Technology Stack",id:"core-technology-stack",level:3},{value:"Component Stack Detail",id:"component-stack-detail",level:3},{value:"Standard Directory Structure",id:"standard-directory-structure",level:3},{value:"Inter-Service Communication Patterns",id:"inter-service-communication-patterns",level:3}];function d(e){const t={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,i.jsxs)(t.p,{children:["\u2003 The Reevo backend architecture is based on a set of independent microservices, written in ",(0,i.jsx)(t.strong,{children:"Python"}),". The choice of this approach aims to ensure ",(0,i.jsx)(t.strong,{children:"high scalability, resilience, and maintainability"}),", allowing teams to develop, deploy, and scale each business domain autonomously."]}),"\n",(0,i.jsx)(t.p,{children:"\u2003 This document establishes the standard technology stack, directory structure, and communication patterns that must be followed by all backend services to maintain technical cohesion and quality across the entire ecosystem."}),"\n",(0,i.jsx)(t.h3,{id:"core-technology-stack",children:"Core Technology Stack"}),"\n",(0,i.jsx)(t.p,{children:"\u2003 To ensure consistency and productivity, all Reevo backend services must be built using the following technology stack:"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Component"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Recommended Technology/Standard"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Primary Advantage"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"API Framework"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"FastAPI"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Performance, native async, automatic docs and validation"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"ORM (DB)"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"SQLAlchemy 2.0+"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Industry standard, productive, and with async support"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"Schema Migrations"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"Alembic"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Secure database versioning"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"Validation/Serialization"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"Pydantic"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Integrated with FastAPI, ensures data integrity"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"Authentication"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"JWT with OAuth2"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Stateless and secure standard for microservices"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"Dependencies"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"Poetry"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Modern management and repeatable builds"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"Testing"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"Pytest"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Python community standard, flexible and powerful"})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"component-stack-detail",children:"Component Stack Detail"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"API Framework: FastAPI"}),"\n\u2003 FastAPI is the foundation of all our services. Its ",(0,i.jsx)(t.strong,{children:"high performance"})," and native support for ",(0,i.jsx)(t.strong,{children:"asynchronous operations"})," (",(0,i.jsx)(t.code,{children:"async/await"}),") are essential for building a responsive and scalable platform, capable of handling a large volume of I/O operations (database queries, external API calls), in compliance with our performance requirements (",(0,i.jsx)(t.code,{children:"RNF-ED-01"}),")."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Database Interaction: SQLAlchemy"}),"\n\u2003 Communication with the ",(0,i.jsx)(t.strong,{children:"PostgreSQL"})," database is abstracted by ",(0,i.jsx)(t.strong,{children:"SQLAlchemy"}),", the standard ORM for the Python community. We exclusively use its ",(0,i.jsx)(t.strong,{children:"asynchronous engine"})," (",(0,i.jsx)(t.code,{children:"create_async_engine"}),"), which integrates with FastAPI. Database tables are mapped to Python classes (",(0,i.jsx)(t.code,{children:"models"}),"), which increases productivity and code safety."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Data Validation: Pydantic"}),"\n\u2003 Pydantic is used to define clear data schemas for all API operations. We adopt the standard of having specific schemas for input (",(0,i.jsx)(t.strong,{children:"Request Models"}),") and output (",(0,i.jsx)(t.strong,{children:"Response Models"}),"), which provides us with:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Automatic Validation:"})," Requests with invalid or missing data are automatically rejected by the framework."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Security:"})," Prevents accidental leakage of internal data by exposing only the fields defined in the response schema."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Automatic Documentation:"})," Pydantic schemas are the single source of truth for ",(0,i.jsx)(t.strong,{children:"OpenAPI documentation generation"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Database Migrations: Alembic"}),"\n\u2003 Every change to the database schema (SQLAlchemy models) must be accompanied by a migration script generated by ",(0,i.jsx)(t.strong,{children:"Alembic"}),". This ensures that database evolution is controlled, versioned, and can be applied safely and consistently in any environment."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Authentication and Authorization: JWT (OAuth2)"}),"\n\u2003 Security between services is based on ",(0,i.jsx)(t.strong,{children:"JSON Web Tokens (JWT)"}),". The Accounts Service acts as the identity provider, issuing a JWT to the user after a successful login. All subsequent calls to any microservice must contain this token in the ",(0,i.jsx)(t.strong,{children:"Authorization header"}),". Each service is responsible for validating the token's signature and permissions before processing the request."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Dependency Management: Poetry"}),"\n\u2003 ",(0,i.jsx)(t.strong,{children:"Poetry"})," is the standard tool for dependency management and virtual environments across all projects. The use of ",(0,i.jsx)(t.code,{children:"pyproject.toml"})," and ",(0,i.jsx)(t.code,{children:"poetry.lock"})," ensures that all environments (development, testing, production) are ",(0,i.jsx)(t.strong,{children:"identical"}),", eliminating consistency issues."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Testing: Pytest"}),"\n\u2003 Software quality is ensured through an automated test suite written with ",(0,i.jsx)(t.strong,{children:"Pytest"}),". FastAPI provides a ",(0,i.jsx)(t.strong,{children:"TestClient"})," that facilitates writing integration tests, allowing API requests to be simulated without the need for a running server."]}),"\n",(0,i.jsx)(t.h3,{id:"standard-directory-structure",children:"Standard Directory Structure"}),"\n",(0,i.jsx)(t.p,{children:"To ensure consistency and facilitate navigation between projects, all microservices must follow the directory structure below:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-md",children:"/service-name\n\u251c\u2500\u2500 /alembic/                # Database migration scripts (Alembic)\n\u251c\u2500\u2500 /app/\n\u2502   \u251c\u2500\u2500 /api/                  # API Endpoints/Routers, request entry layer.\n\u2502   \u251c\u2500\u2500 /core/                 # Central application configurations (e.g., settings).\n\u2502   \u251c\u2500\u2500 /crud/                 # Data access functions (database logic).\n\u2502   \u251c\u2500\u2500 /models/               # Classes representing database tables (SQLAlchemy).\n\u2502   \u251c\u2500\u2500 /schemas/              # API data validation classes (Pydantic).\n\u2502   \u2514\u2500\u2500 main.py                # FastAPI application entry point.\n\u251c\u2500\u2500 /tests/                    # Automated tests (Pytest).\n\u251c\u2500\u2500 pyproject.toml             # Project definition and dependencies (Poetry).\n\u2514\u2500\u2500 poetry.lock                # Dependency lock file.\n"})}),"\n",(0,i.jsx)(t.h3,{id:"inter-service-communication-patterns",children:"Inter-Service Communication Patterns"}),"\n",(0,i.jsx)(t.p,{children:"\u2003 Communication within the Reevo microservice ecosystem follows two main patterns:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Synchronous Communication (RESTful APIs)"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"When to use:"})," For command or query interactions that require an immediate response."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Example:"})," The Frontend requests the list of available CPRs from the Marketplace Service. The request must be answered immediately with the data."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Mechanism:"})," Direct ",(0,i.jsx)(t.strong,{children:"HTTP/S calls"})," between services, generally orchestrated through an ",(0,i.jsx)(t.strong,{children:"API Gateway"}),", which acts as the single entry point for all external requests."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Asynchronous Communication (Event-Driven)"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"When to use:"})," To ",(0,i.jsx)(t.strong,{children:"decouple services"})," and for processes that can be executed in the background, without the requester needing to wait for a response."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Example:"})," When the Wallet Service confirms an installment payment, it publishes a ",(0,i.jsx)(t.code,{children:"PaymentConfirmed"})," event. The Notifications Service and the Distribution Service listen to this event and react to it independently, without the Wallet Service needing to know of their existence."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Mechanism:"})," Use of a ",(0,i.jsx)(t.strong,{children:"Message Broker"})," (such as RabbitMQ or AWS SQS), which has already been anticipated in our sequence diagrams."]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var s=n(6540);const i={},r=s.createContext(i);function a(e){const t=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);