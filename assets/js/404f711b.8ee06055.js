"use strict";(self.webpackChunkhackathon_transpetro=self.webpackChunkhackathon_transpetro||[]).push([[488],{772:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"implementacao_tecnica/back_end","title":"Back End","description":"Introdu\xe7\xe3o","source":"@site/docs/implementacao_tecnica/back_end.md","sourceDirName":"implementacao_tecnica","slug":"/implementacao_tecnica/back_end","permalink":"/Hackaton-Transpetro/implementacao_tecnica/back_end","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"Back End"},"sidebar":"defaultSidebar","previous":{"title":"Plano de Infraestrutura","permalink":"/Hackaton-Transpetro/implementacao_tecnica/infraestrutura"},"next":{"title":"Seguran\xe7a","permalink":"/Hackaton-Transpetro/implementacao_tecnica/seguranca"}}');var a=s(4848),o=s(8453);const r={sidebar_position:5,title:"Back End"},i=void 0,d={},c=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"Stack Tecnol\xf3gico Core",id:"stack-tecnol\xf3gico-core",level:2},{value:"Detalhamento dos Componentes",id:"detalhamento-dos-componentes",level:2},{value:"API Framework \u2014 FastAPI",id:"api-framework--fastapi",level:3},{value:"Intera\xe7\xe3o com Banco de Dados \u2014 SQLAlchemy (async)",id:"intera\xe7\xe3o-com-banco-de-dados--sqlalchemy-async",level:3},{value:"Valida\xe7\xe3o de Dados \u2014 Pydantic",id:"valida\xe7\xe3o-de-dados--pydantic",level:3},{value:"Migra\xe7\xf5es \u2014 Alembic",id:"migra\xe7\xf5es--alembic",level:3},{value:"Autentica\xe7\xe3o e Autoriza\xe7\xe3o \u2014 JWT / OAuth2",id:"autentica\xe7\xe3o-e-autoriza\xe7\xe3o--jwt--oauth2",level:3},{value:"Gerenciamento de Depend\xeancias \u2014 Poetry",id:"gerenciamento-de-depend\xeancias--poetry",level:3},{value:"Testes \u2014 Pytest",id:"testes--pytest",level:3},{value:"Estrutura de Diret\xf3rios Padr\xe3o",id:"estrutura-de-diret\xf3rios-padr\xe3o",level:2}];function l(e){const t={code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,a.jsxs)(t.p,{children:["\u2003A arquitetura de backend do ",(0,a.jsx)(t.strong,{children:"Nautilus / Transpetro"})," \xe9 composta por um conjunto de microservi\xe7os independentes, escritos em ",(0,a.jsx)(t.strong,{children:"Python"}),". Essa abordagem busca garantir ",(0,a.jsx)(t.strong,{children:"alta escalabilidade, resili\xeancia e manutenibilidade"}),", permitindo que equipes desenvolvam, deployem e escalem cada dom\xednio de neg\xf3cio de forma aut\xf4noma."]}),"\n",(0,a.jsxs)(t.p,{children:["\u2003Este documento estabelece o ",(0,a.jsx)(t.strong,{children:"stack tecnol\xf3gico padr\xe3o"}),", a ",(0,a.jsx)(t.strong,{children:"estrutura de diret\xf3rios"})," e os ",(0,a.jsx)(t.strong,{children:"padr\xf5es de comunica\xe7\xe3o"})," que devem ser seguidos por todos os servi\xe7os backend para manter coes\xe3o t\xe9cnica e qualidade em todo o ecossistema."]}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"stack-tecnol\xf3gico-core",children:"Stack Tecnol\xf3gico Core"}),"\n",(0,a.jsx)(t.p,{children:"\u2003Para garantir consist\xeancia e produtividade, os servi\xe7os backend devem adotar o seguinte stack:"}),"\n",(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{style:{textAlign:"left"},children:"Componente"}),(0,a.jsx)(t.th,{style:{textAlign:"left"},children:"Tecnologia / Padr\xe3o recomendado"}),(0,a.jsx)(t.th,{style:{textAlign:"left"},children:"Vantagem principal"})]})}),(0,a.jsxs)(t.tbody,{children:[(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"API Framework"})}),(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"FastAPI"})}),(0,a.jsx)(t.td,{style:{textAlign:"left"},children:"Alta performance, suporte nativo a async, documenta\xe7\xe3o autom\xe1tica e valida\xe7\xe3o integrada."})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"ORM (DB)"})}),(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"SQLAlchemy 2.0+ (async)"})}),(0,a.jsx)(t.td,{style:{textAlign:"left"},children:"Padr\xe3o da comunidade, produtivo e com suporte ass\xedncrono."})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"Migra\xe7\xf5es"})}),(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"Alembic"})}),(0,a.jsx)(t.td,{style:{textAlign:"left"},children:"Versionamento seguro do esquema de banco de dados."})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"Valida\xe7\xe3o / Serializa\xe7\xe3o"})}),(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"Pydantic"})}),(0,a.jsx)(t.td,{style:{textAlign:"left"},children:"Integra\xe7\xe3o nativa com FastAPI; fonte de verdade para OpenAPI."})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"Autentica\xe7\xe3o"})}),(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"JWT (OAuth2)"})}),(0,a.jsx)(t.td,{style:{textAlign:"left"},children:"Padr\xe3o stateless e seguro para microservi\xe7os."})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"Gerenciamento de depend\xeancias"})}),(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"Poetry"})}),(0,a.jsx)(t.td,{style:{textAlign:"left"},children:"Builds reprodut\xedveis e gerenciamento moderno de pacotes."})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"Testes"})}),(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"Pytest"})}),(0,a.jsx)(t.td,{style:{textAlign:"left"},children:"Padr\xe3o da comunidade Python para testes unit\xe1rios e de integra\xe7\xe3o."})]})]})]}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"detalhamento-dos-componentes",children:"Detalhamento dos Componentes"}),"\n",(0,a.jsx)(t.h3,{id:"api-framework--fastapi",children:"API Framework \u2014 FastAPI"}),"\n",(0,a.jsxs)(t.p,{children:["\u2003FastAPI \xe9 a base de todos os nossos servi\xe7os. Seu alto desempenho e suporte a opera\xe7\xf5es ass\xedncronas (",(0,a.jsx)(t.code,{children:"async/await"}),") s\xe3o fundamentais para construir uma plataforma responsiva e escal\xe1vel, capaz de lidar com um grande volume de I/O (consultas ao banco, chamadas a APIs externas)."]}),"\n",(0,a.jsx)(t.h3,{id:"intera\xe7\xe3o-com-banco-de-dados--sqlalchemy-async",children:"Intera\xe7\xe3o com Banco de Dados \u2014 SQLAlchemy (async)"}),"\n",(0,a.jsxs)(t.p,{children:["\u2003A comunica\xe7\xe3o com o banco (PostgreSQL recomendado) \xe9 feita via ",(0,a.jsx)(t.strong,{children:"SQLAlchemy"})," com engine ass\xedncrono (",(0,a.jsx)(t.code,{children:"create_async_engine"}),"). As tabelas s\xe3o mapeadas em classes Python (models), facilitando a manuten\xe7\xe3o e seguran\xe7a do c\xf3digo."]}),"\n",(0,a.jsx)(t.h3,{id:"valida\xe7\xe3o-de-dados--pydantic",children:"Valida\xe7\xe3o de Dados \u2014 Pydantic"}),"\n",(0,a.jsx)(t.p,{children:"\u2003Pydantic define schemas claros para inputs e outputs da API. Boas pr\xe1ticas:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["modelos de ",(0,a.jsx)(t.strong,{children:"Request"})," e ",(0,a.jsx)(t.strong,{children:"Response"})," separados;"]}),"\n",(0,a.jsx)(t.li,{children:"evitar exposi\xe7\xe3o de campos internos sens\xedveis;"}),"\n",(0,a.jsxs)(t.li,{children:["usar ",(0,a.jsx)(t.code,{children:"Field(...)"})," com descri\xe7\xf5es para gerar documenta\xe7\xe3o rica."]}),"\n"]}),"\n",(0,a.jsx)(t.h3,{id:"migra\xe7\xf5es--alembic",children:"Migra\xe7\xf5es \u2014 Alembic"}),"\n",(0,a.jsx)(t.p,{children:"\u2003Toda altera\xe7\xe3o no modelo de dados (SQLAlchemy) deve ser acompanhada por um script de migra\xe7\xe3o gerado via Alembic e versionado no reposit\xf3rio."}),"\n",(0,a.jsx)(t.h3,{id:"autentica\xe7\xe3o-e-autoriza\xe7\xe3o--jwt--oauth2",children:"Autentica\xe7\xe3o e Autoriza\xe7\xe3o \u2014 JWT / OAuth2"}),"\n",(0,a.jsxs)(t.p,{children:["\u2003A autentica\xe7\xe3o \xe9 baseada em ",(0,a.jsx)(t.strong,{children:"JWT"})," emitidos pelo Accounts Service. Todos os requests entre servi\xe7os e do cliente devem conter o token no header ",(0,a.jsx)(t.code,{children:"Authorization: Bearer <token>"}),". Cada servi\xe7o valida assinatura e escopos antes de processar a requisi\xe7\xe3o."]}),"\n",(0,a.jsx)(t.h3,{id:"gerenciamento-de-depend\xeancias--poetry",children:"Gerenciamento de Depend\xeancias \u2014 Poetry"}),"\n",(0,a.jsxs)(t.p,{children:["\u2003Padronizamos o uso do ",(0,a.jsx)(t.strong,{children:"Poetry"})," (",(0,a.jsx)(t.code,{children:"pyproject.toml"})," + ",(0,a.jsx)(t.code,{children:"poetry.lock"}),") para garantir ambientes reprodut\xedveis entre dev/test/prod."]}),"\n",(0,a.jsx)(t.h3,{id:"testes--pytest",children:"Testes \u2014 Pytest"}),"\n",(0,a.jsxs)(t.p,{children:["\u2003A qualidade do software \xe9 assegurada por testes automatizados com ",(0,a.jsx)(t.strong,{children:"Pytest"}),". Utilize o ",(0,a.jsx)(t.code,{children:"TestClient"})," do FastAPI para testes de integra\xe7\xe3o sem necessidade de servidor em execu\xe7\xe3o."]}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h2,{id:"estrutura-de-diret\xf3rios-padr\xe3o",children:"Estrutura de Diret\xf3rios Padr\xe3o"}),"\n",(0,a.jsx)(t.p,{children:"\u2003Para consist\xeancia entre servi\xe7os, adote a estrutura abaixo:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-text",children:"/service-name\n\u251c\u2500\u2500 /alembic/                # Scripts de migra\xe7\xe3o do banco (Alembic)\n\u251c\u2500\u2500 /app/\n\u2502   \u251c\u2500\u2500 /api/                # Endpoints / Routers (camada de entrada)\n\u2502   \u251c\u2500\u2500 /core/               # Configura\xe7\xf5es centrais (settings, logger)\n\u2502   \u251c\u2500\u2500 /crud/               # Fun\xe7\xf5es de acesso a dados (DB logic)\n\u2502   \u251c\u2500\u2500 /models/             # SQLAlchemy models (tabelas)\n\u2502   \u251c\u2500\u2500 /schemas/            # Pydantic schemas (Request/Response)\n\u2502   \u251c\u2500\u2500 /services/           # Regras de neg\xf3cio / integra\xe7\xf5es externas\n\u2502   \u2514\u2500\u2500 main.py              # Ponto de entrada do FastAPI\n\u251c\u2500\u2500 /tests/                  # Testes automatizados (Pytest)\n\u251c\u2500\u2500 pyproject.toml           # Depend\xeancias e configura\xe7\xe3o do Poetry\n\u2514\u2500\u2500 poetry.lock              # Lockfile de depend\xeancias\n"})})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>r,x:()=>i});var n=s(6540);const a={},o=n.createContext(a);function r(e){const t=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);